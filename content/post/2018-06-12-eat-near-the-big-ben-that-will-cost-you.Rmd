---
title: Eat near the Big Ben?  That will cost you...
author: ''
date: '2018-06-12'
slug: eat-near-the-big-ben-that-will-cost-you
categories: []
tags:
  - MakeoverMonday
header:
  caption: ''
  image: ''
---

```{r, echo = F}
knitr::opts_knit$set(root.dir = normalizePath("../../../../Google Drive/side_projects/makeover_mondays/2017.12.04WetherspoonCurry/"))
knitr::opts_chunk$set(message = F, warning = F)
```

What's the cost of eating near an iconic location?  We all might suspect eating in a fun location is pricier.  I used the menu and restaurant location data that #MakeoverMonday "assigned" one week last December to demonstrate this among London [Wetherspoon Pubs](https://www.jdwetherspoon.com/).

\#MakeoverMonday is a fun data visualization initiative; most participants use Tableau as their preferred visualization tool.  But I've used R and ggplot() and the organizers and participants have been very welcoming.  (Recently, I've noticed an initiative for R has sprouted up --- #TidyTuesday, with a focus on visualization and data wrangling. Might #MakeoverMonday have been an inspiration?  Probably.)

```{r echo=FALSE}
blogdown::shortcode('tweet', '939065290016555008')
```

The Wetherspoon Pubs plot that I submitted was popular with the organizers of #MakeoverMonday, and it will likely be featured in their soon-to-be-published book on the #MakeoverMonday experience. 

```{r echo=FALSE}
blogdown::shortcode('tweet', '939073785994661888')
```

You can read Andy Kreible's complete "lessons" summary on the entries from the Wetherspoon Pubs week [here]( http://www.makeovermonday.co.uk/week-49/).

I was happy to be working with some spatial data.  

```{r echo=FALSE}
blogdown::shortcode('tweet', '939405276314259456')
```

Basically, I did some mapping to explore the data, but suspected that having a closer look at London Pubs might also be interesting.  To do that I had to compute distances from longitude and latitude coordinates in R.  I just used a pre-written function from the geosphere package to do this.

Below is the code (cleaned-up naturally for this post) used in the exercise.  

# Step one:  Load needed packages and data
```{r, fig.width=15}
library(readxl)    # to load excel data
library(rgdal)     # geospatial library
library(tidyverse) # data wrangling and plotting
library(geosphere) # to calculate distances on the earth
library(viridis)   # for better color palette for points on map
library(ggmap)     # provides maps and mapping tools for ggplot

# Public holiday data
data0=read_xlsx("Wetherspoon.xlsx", na = "n/a") 
```

# Step 2:  Mapping data

```{r, cache=T}

# Loading required package: ggplot2
# Google Maps API Terms of Service: http://developers.google.com/maps/terms.
# Please cite ggmap if you use it: see citation('ggmap') for details.

# Mapping data
world_map_df <- map_data("world")
```

I map the UK ...
```{r}
# create a ggplot theme
theme_opts <- list(theme(panel.grid.minor = element_blank(),
                        panel.grid.major = element_blank(),
                        panel.background = element_blank(),
                        plot.background = element_rect(fill="#e6e8ed"),
                        panel.border = element_blank(),
                        axis.line = element_blank(),
                        axis.text = element_blank(),
                        axis.ticks = element_blank(),
                        axis.title = element_blank(),
                        plot.title = element_text(size=15)))

g <- ggplot(world_map_df %>% 
              filter(region=="UK"), aes(long,lat, group=group)) + 
  geom_polygon(fill = "white") +  # plot polygon (region)
  coord_equal() +  # 
  theme_opts +  # use theme - created above
  ggtitle("Food Versus Drink Prices", "@EvaMaeRey | source: data.worldbank.org" )

g
```
... and overlay the information about the burger price.

```{r}
g + geom_point(data = data0, 
              aes(x=Longitude, y=Latitude, 
                  group=NULL, fill=`Empire State Burger`), 
              colour="white", shape=21, stroke=1, 
              alpha=.75, size = 2, shape = 25) + 
  scale_fill_viridis(option = "magma", direction = -1)  # use prefered color scale


```

Looks like there are some pricy places to get a burger on the sea!

# Step 3:  Calculate restaurant distances from iconic location and plot prices as function thereof

Zooming in to focus on a London story, I decided to calculate restaurant distances from the Big Ben using the distm() function from the geosphere package ... 
```{r}
# big ben coordinates found on https://www.latlong.net
LondonLat <- 51.510357
LondonLong <- -0.116773

# use for loop to calculate distance for each restaurant to Big Ben
data0$`Kilometers from Big Ben` <- NA
for (i in 1:nrow(data0)){

  data0$`Kilometers from Big Ben`[i] <- 
    distm(c(data0$Longitude[i], data0$Latitude[i]), 
          c(LondonLong, LondonLat))/1000
  
}
```

... and to plot prices of different food items as a function of that distance, breaking out the plots by menu item.  

```{r}
data_long = data0 %>% 
  gather(Item, `Menu Item Price`, `Empire State Burger`:MEAL) %>%  # restructure data for graphing
  filter(Item!="MEAL", Item!="Porn Star (glass)")  # delete a couple of items, reduntant or aggregates

ggplot(data_long) +  # declare data to use
  aes(x = `Kilometers from Big Ben`, y = `Menu Item Price`) +  # declare aesthetic mapping
  geom_point() + # draw points
  facet_wrap(~Item, scales = "free_y") + # make unique map for each menu item
  ggtitle("Wetherspoon Pubs' Menu Item Prices  v. Distance from Big Ben", 
          "Visualization: Gina Reynolds | Source: Financial Times Alphaville") + 
  geom_smooth() +  # include loess smoother
  labs(y = "Price - Â£") + 
  xlim(c(0,10))  # limit distance to closest 10 kilometers
```

All done.  Now your're probably hungry and thirsty.  Perhaps you'd like a burger or chicken tikka?
